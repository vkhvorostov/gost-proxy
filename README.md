# Прокси для шифрования взаимодействия с Rest-API по ГОСТ 34.12-2018

Идея продукта состоит в том, чтобы добавить универсальный промежуточный сервис, который позволит шифровать данные, передаваемые между клиентом и сервером, по алгоритмам ГОСТ, ничего при этом не меняя в реализации исходных систем.

![схема взаимодействия](scheme.png)

Прокси представляет собой единое приложение на python3 (FastAPI), конфигурируемое через yaml-файл, которое может работать в двух режимах:

- proxy-client 
- proxy-server

## proxy-client

- получает запрос от клиента, 
- шифрует,
- отправляет на сервер,
- получает с сервера шифрованный ответ,
- расшифровывает его 
- и отдает клиенту

Запуск в режиме proxy-client:

`CONFIG_PATH=client.yaml uvicorn main:app`

## proxy-server

- получает шифрованный запрос от клиента,
- расшифровывает,
- отправляет на сервер,
- получает с сервера ответ, 
- зашифровывает его
- и отдает клиенту

Запуск в режиме proxy-server:

`CONFIG_PATH=server.yaml uvicorn main:app`

## Пример конфигурационного файла

```
target_server_url: "http://127.0.0.1:8001"
response_excluded_headers:
  - date
  - server
  - content-length
request_included_headers:
  - content-type
  - authorization
mode: client
alg: kuznechik
key: 8899aabbccddeeff0011223344556677fedcba98765432100123456789abcdef
```

- **target_server_url:** url куда прокси перенаправляет запросы - для прокси-клиента должен указывать на прокси-сервер, для прокси-сервера должен указывать на конечный апи-ендпоинт
- **response_excluded_headers:** исключаемые из проксирования ответа http-заголовки (обычно те, которые добавляет по-умолчанию сам прокси: date, server, content-length)
- **request_included_headers:** проксируемые заголовки запроса клиента (не перчисленные здесь проксироваться не будут)
- **mode:** server или client
- **alg:** kuznechik или magma
- **key:** ключ длиной 256 бит - строка в 16-ричном формате, как в контрольных примерах ГОСТ 34.12-2018

## Тесты

Для проверки корректности реализации алгоритмов шифрования можно просмотреть и запустить `python3 test.py`